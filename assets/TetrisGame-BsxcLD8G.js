import{d as z,a as T,c as Q,o as tt,i as et,b as y,e as a,f as S,t as nt,w as m,h as b,_ as ot}from"./index-C2rsNQOa.js";const st={class:"tetris-game"},rt={class:"game-info"},it={key:0},at={key:2,class:"touch-instructions"},lt={key:0,class:"mobile-controls"},ct=15,ut=20,u=40,G=1e3,ft=z({__name:"TetrisGame",setup(dt){const D=T(null),O=T(null),k=T(0),f=T(!1),L=Q(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));let r=[];const o={pos:{x:0,y:0},matrix:[],score:0};let v=[],A=0,N=G,I=0;const X={T:[[0,1,0],[1,1,1],[0,0,0]],O:[[2,2],[2,2]],L:[[0,0,3],[3,3,3],[0,0,0]],J:[[4,0,0],[4,4,4],[0,0,0]],I:[[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]],S:[[0,6,6],[6,6,0],[0,0,0]],Z:[[7,7,0],[0,7,7],[0,0,0]]},B=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"],H=(e,t)=>{const n=[];for(;t--;)n.push(new Array(e).fill(0));return n},E=()=>{const e="TOLJISZ",t=e[Math.floor(Math.random()*e.length)];return JSON.parse(JSON.stringify(X[t]))},q=e=>{if(e.length===0||!e[0]||e[0].length===0)return e;const t=[];for(let n=0;n<e[0].length;n++)t[n]=new Array(e.length).fill(0);for(let n=0;n<e.length;n++){const s=e[n];if(s){for(let i=0;i<e[0].length;i++)if(s[i]!==void 0){const c=s[i],l=t[i];l&&c!==void 0&&(l[e.length-1-n]=c)}}}return t},g=(e,t)=>{const[n,s]=[t.matrix,t.pos];for(let i=0;i<n.length;++i){const c=n[i];if(c){for(let l=0;l<(n[0]?n[0].length:0);++l)if(c[l]!==0){const x=e[i+s.y];if(x===void 0||x[l+s.x]===void 0||x[l+s.x]!==0)return!0}}}return!1},J=(e,t)=>{t.matrix.forEach((n,s)=>{n.forEach((i,c)=>{if(i!==0){const l=e[s+t.pos.y];l&&l[c+t.pos.x]!==void 0&&(l[c+t.pos.x]=i)}})})},V=()=>{let e=1;t:for(let t=r.length-1;t>0;--t){for(let n=0;n<(r[0]?r[0].length:0);++n){const s=r[t];if(s&&s[n]===0)continue t}if(r[t]){const n=r.splice(t,1)[0]?.fill(0)||Array(r[0]?.length||0).fill(0);r.unshift(n),++t,k.value+=e*10,e*=2}}},U=()=>{o.matrix=v,v=E(),o.pos.y=0,r[0]&&o.matrix[0]&&(o.pos.x=Math.floor((r[0].length-o.matrix[0].length)/2)),g(r,o)&&(r.forEach(e=>e.fill(0)),k.value=0,f.value=!0),P()},d=e=>{o.pos.x+=e,g(r,o)&&(o.pos.x-=e)},h=e=>{const t=o.pos.x;let n=e;const s=o.matrix;for(o.matrix=q(o.matrix);g(r,o);){o.pos.x+=n,n=-(n+(n>0?1:-1));const i=o.matrix[0]?o.matrix[0].length:0;if(Math.abs(n)>i){o.matrix=s,o.pos.x=t;return}}},p=()=>{o.pos.y++,g(r,o)&&(o.pos.y--,J(r,o),U(),V(),N=G),A=0},M=()=>{for(;!g(r,o);)o.pos.y++;o.pos.y--,p()},F=(e,t,n)=>{const s=n.getContext("2d");s&&e.forEach((i,c)=>{i.forEach((l,x)=>{l!==0&&(s.fillStyle=B[l],s.fillRect((x+t.x)*u,(c+t.y)*u,u,u),s.strokeStyle="#000",s.strokeRect((x+t.x)*u,(c+t.y)*u,u,u))})})},P=()=>{const e=O.value;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#000",t.fillRect(0,0,e.width,e.height);const n=v[0]?(e.width/u-v[0].length)/2:0,s=(e.height/u-v.length)/2;F(v,{x:n,y:s},e)},W=()=>{const e=D.value;if(!e)return;const t=e.getContext("2d");t&&(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),F(r,{x:0,y:0},e),F(o.matrix,o.pos,e))},R=(e=0)=>{if(f.value)return;const t=e-I;I=e,A+=t,A>N&&p(),W(),requestAnimationFrame(R)},Y=()=>{r=H(ct,ut),o.score=0,o.pos={x:0,y:0},o.matrix=E(),v=E(),f.value=!1,k.value=0,P()},_=e=>{if(!f.value)switch(e.key){case"ArrowLeft":d(-1);break;case"ArrowRight":d(1);break;case"ArrowDown":p();break;case"ArrowUp":h(1);break;case"q":h(-1);break;case"w":h(1);break;case" ":M();break}};let C=0,w=0,$=0;const Z=e=>{if(f.value)return;const t=e.touches[0];t&&(C=t.clientX,w=t.clientY,$=Date.now())},K=e=>{if(!f.value&&(e.preventDefault(),e.touches.length>0)){const t=e.touches[0];if(!t)return;const n=t.clientX-C,s=t.clientY-w,i=Date.now();Math.abs(n)>30&&(n>0?d(1):d(-1),C=t.clientX,w=t.clientY),s>50&&(p(),w=t.clientY),s<-50&&(h(1),w=t.clientY),s>100&&i-$<300&&(M(),w=t.clientY)}},j=()=>{Y(),f.value=!1,requestAnimationFrame(R)};return tt(()=>{Y(),window.addEventListener("keydown",_),requestAnimationFrame(R)}),et(()=>{window.removeEventListener("keydown",_)}),(e,t)=>(b(),y("div",st,[a("div",rt,[a("div",null,"Score: "+nt(k.value),1),t[9]||(t[9]=a("div",null,"Next Piece:",-1)),a("canvas",{ref_key:"nextCanvas",ref:O,class:"next-piece",width:"120",height:"120"},null,512),f.value?(b(),y("div",it,"Game Over!")):S("",!0),f.value?(b(),y("button",{key:1,onClick:j},"New Game")):S("",!0),L.value?(b(),y("div",at,[...t[8]||(t[8]=[a("p",null,"触摸操作说明:",-1),a("p",null,"- 左右滑动: 移动方块",-1),a("p",null,"- 向下滑动: 下落",-1),a("p",null,"- 向上滑动: 旋转",-1),a("p",null,"- 快速下滑: 硬降落",-1),a("p",null,"- 也可使用下方按钮控制",-1)])])):S("",!0)]),a("canvas",{ref_key:"tetrisCanvas",ref:D,class:"game-canvas",width:"600",height:"800",onTouchstart:Z,onTouchmove:K},null,544),L.value?(b(),y("div",lt,[a("button",{onTouchstart:t[0]||(t[0]=m(n=>h(-1),["prevent"])),onMousedown:t[1]||(t[1]=n=>h(-1))},"↻ Left",32),a("button",{onTouchstart:t[2]||(t[2]=m(n=>d(-1),["prevent"])),onMousedown:t[3]||(t[3]=n=>d(-1))},"← Left",32),a("button",{onTouchstart:t[4]||(t[4]=m(n=>d(1),["prevent"])),onMousedown:t[5]||(t[5]=n=>d(1))},"Right →",32),a("button",{onTouchstart:t[6]||(t[6]=m(n=>h(1),["prevent"])),onMousedown:t[7]||(t[7]=n=>h(1))},"Right ↺",32),a("button",{onTouchstart:m(p,["prevent"]),onMousedown:p},"↓ Drop",32),a("button",{onTouchstart:m(M,["prevent"]),onMousedown:M},"⤓ Hard Drop",32)])):S("",!0)]))}}),vt=ot(ft,[["__scopeId","data-v-f568eba0"]]);export{vt as default};
//# sourceMappingURL=TetrisGame-BsxcLD8G.js.map
